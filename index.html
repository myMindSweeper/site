<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>myMindSweeper</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" ></script>
<!--    <script src="dropzone.js"></script>-->
    <meta name="google-signin-client_id" content="263280707472-o46anofpr2aoc3aslltgeaegjg3qpqlp.apps.googleusercontent.com">
</head>
<body>
    <section class="main">
        <div class="container phone">
            <div class="phone screen">
                <div class="demo">
                    <video src="video/demo.mp4" autoplay loop></video>
                </div>
            </div>
        </div>
        <div class="container info">
            <img src="imgs/logo.svg" alt="" class="logo">
            <h2 class="excerpt">Helping those with mental illness safely traverse their personal minefields. </h2>
            <div class="buttons">
                <a href="#" class="button">Download App</a>
<!--                <a href="#" class="button upload disabled">Upload Data</a>-->
                <div class="g-signin2" data-onsuccess="onSignIn"></div>
            </div>
        </div>
    </section>
    <section class="file-upload hidden">
        <div class="container">
            <div>
                <p>Stuff goes here</p>
            </div>
        </div>
        <div class="container info">
           <div id="dropzone" ondragover="dragover_handler(event);" ondrop="processFiles(event);">Drop files here...</div>
        </div>
    </section>
    <section class="about">
        <div>
            <div class="content">
                <h1>About the Team</h1>
                <p></p>
            </div>
            <div class="profiles">
                <img src="" alt="">
                <img src="" alt="">
                <img src="" alt="">
                <img src="" alt="">
            </div>
        </div>
    </section>
    <section></section>
    <script type="application/javascript">
        var id_token;
        
        function onSignIn(googleUser) {
          id_token = googleUser.getAuthResponse().id_token;
            console.log("SIGNED IN SUCCESSFULLY " + id_token);
            $(".file-upload").toggleClass("hidden");
            
        }
        
        function dragover_handler(ev) {
          // Prevent default select and drag behavior
          ev.preventDefault();
        }
        
        function processFiles(e) {
        
            e.preventDefault();

            
          // var preview = document.querySelector('#preview');
          var files   = e.dataTransfer.files;
          var datas = [];

          function readAndPreview(file) {

            // Make sure `file.name` matches our extensions criteria

              var reader = new FileReader();

              reader.addEventListener("load", function () {
                // var image = new Image();
                // image.height = 100;
                // image.title = file.name;
                // image.src = this.result;
                // preview.appendChild( image );

                // console.log(this.result);

                datas.push(this.result);
                console.log(datas.length);
                  if(datas.length == files.length){
                      console.log("DONE");
                      sendFiles(datas);
                  }

              }, false);

              reader.readAsText(file);
            }



          if (files) {
            [].forEach.call(files, readAndPreview);
          }

        }
        
        function sendFiles(filesToSend){
            var jsonData = {
                    token: id_token,
                    files: filesToSend
                };
//            console.log(jsonData);\
            jsonData = JSON.stringify(jsonData);
//            console.log(JSON.stringify(jsonData));
            $.post({
                url: "http://54.163.167.120:5000/upload-fb",
                data: jsonData,
                contentType: "application/json",
                dataType: "json"
            }).always(function(jqXHR){
                $(".file-upload").toggleClass("hidden");
                console.log(jqXHR);
            });
        }
        
//        const retrievePromise = googleyolo.retrieve({
//          supportedAuthMethods: [
//            "https://accounts.google.com",
//            "googleyolo://id-and-password"
//          ],
//          supportedIdTokenProviders: [
//            {
//              uri: "https://accounts.google.com",
//              clientId: "263280707472-o46anofpr2aoc3aslltgeaegjg3qpqlp.apps.googleusercontent.com"
//            }
//          ]
//        });
////        $('.button.upload').on('click', e => (
////            
////        ));
//        
//        const hintPromise = googleyolo.hint({
//          supportedAuthMethods: [
//            "https://accounts.google.com"
//          ],
//          supportedIdTokenProviders: [
//            {
//              uri: "https://accounts.google.com",
//              clientId: "263280707472-o46anofpr2aoc3aslltgeaegjg3qpqlp.apps.googleusercontent.com"
//            }
//          ]
//        });


    </script>
</body>
</html>